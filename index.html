<!DOCTYPE html>
<html lang="vi" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng c·ª• Ng√¥n ng·ªØ √äƒë√™-Vi·ªát</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony Neutrals with Teal Accent (Light & Dark Variants) -->
    <!-- Application Structure Plan: ·ª®ng d·ª•ng ƒë∆∞·ª£c c·∫•u tr√∫c d∆∞·ªõi d·∫°ng m·ªôt b·∫£ng ƒëi·ªÅu khi·ªÉn (dashboard) v·ªõi c√°c tab ch·ª©c nƒÉng, thay v√¨ m·ªôt trang cu·ªôn d√†i. C·∫•u tr√∫c n√†y ƒë∆∞·ª£c ch·ªçn v√¨ n√≥ ph√¢n chia r√µ r√†ng c√°c c√¥ng c·ª• kh√°c nhau (T·ª´ ƒëi·ªÉn, D·ªãch ·∫£nh, H·ªçc t·∫≠p, Luy·ªán t·∫≠p) theo nhi·ªám v·ª• c·ªßa ng∆∞·ªùi d√πng. C√°ch ti·∫øp c·∫≠n n√†y gi√∫p gi·∫£m s·ª± ph·ª©c t·∫°p c·ªßa giao di·ªán, cho ph√©p ng∆∞·ªùi d√πng t·∫≠p trung v√†o m·ªôt t√°c v·ª• t·∫°i m·ªôt th·ªùi ƒëi·ªÉm v√† d·ªÖ d√†ng ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn c√¥ng c·ª• h·ªç c·∫ßn. Lu·ªìng ng∆∞·ªùi d√πng b·∫Øt ƒë·∫ßu t·∫°i t√≠nh nƒÉng c·ªët l√µi l√† d·ªãch thu·∫≠t v√† c√≥ th·ªÉ d·ªÖ d√†ng kh√°m ph√° c√°c t√≠nh nƒÉng n√¢ng cao kh√°c. -->
    <!-- Visualization & Content Choices: V√¨ d·ªØ li·ªáu ngu·ªìn l√† vƒÉn b·∫£n (t·ª´ ƒëi·ªÉn), kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªãnh l∆∞·ª£ng ƒë·ªÉ v·∫Ω bi·ªÉu ƒë·ªì. Do ƒë√≥, "tr·ª±c quan h√≥a" ƒë∆∞·ª£c th·ª±c hi·ªán th√¥ng qua vi·ªác s·ª≠ d·ª•ng c√°c th√†nh ph·∫ßn giao di·ªán t∆∞∆°ng t√°c (HTML/CSS/JS) thay v√¨ bi·ªÉu ƒë·ªì (Chart.js). D·ªØ li·ªáu ƒë∆∞·ª£c tr√¨nh b√†y trong c√°c th·∫ª, b·ªë c·ª•c hai c·ªôt v√† c√°c bi·ªÉu m·∫´u t∆∞∆°ng t√°c. M·ª•c ti√™u: D·ªãch/Th√¥ng b√°o -> Ph∆∞∆°ng ph√°p: B·ªë c·ª•c hai c·ªôt cho vƒÉn b·∫£n, k·∫øt qu·∫£ t√¨m ki·∫øm ƒë·ªông. M·ª•c ti√™u: T∆∞∆°ng t√°c/H·ªçc t·∫≠p -> Ph∆∞∆°ng ph√°p: C√°c n√∫t ƒë·ªÉ k√≠ch ho·∫°t c√°c ch·ª©c nƒÉng AI m√¥ ph·ªèng (t·∫°o v√≠ d·ª•, b√†i t·∫≠p), c√°c bi·ªÉu m·∫´u ƒë·ªÉ ng∆∞·ªùi d√πng nh·∫≠p li·ªáu. C√°ch ti·∫øp c·∫≠n n√†y tr·ª±c ti·∫øp h·ªó tr·ª£ c·∫•u tr√∫c ·ª©ng d·ª•ng theo ƒë·ªãnh h∆∞·ªõng nhi·ªám v·ª•. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --bg-light: #F9F5F0;
            --text-light: #44403C;
            --card-bg-light: #FFFFFF;
            --border-light: #E7E5E4; /* Stone-200 */
            --input-bg-light: #FAFAFA; /* Stone-50 */
            --primary-btn-bg-light: #0D9488; /* Teal-600 */
            --primary-btn-hover-light: #0F766E; /* Teal-700 */
            --secondary-btn-bg-light: #E7E5E4; /* Stone-200 */
            --secondary-btn-text-light: #57534E; /* Stone-700 */
            --secondary-btn-hover-light: #D6D3D1; /* Stone-300 */
            --tab-active-bg-light: #0D9488;
            --tab-active-text-light: #FFFFFF;
            --tab-hover-light: #CCFBF1; /* Teal-100 */
            --loader-border-top-light: #0D9488;
            --success-text-light: #16A34A; /* Green-600 */
            --error-text-light: #DC2626; /* Red-600 */
            --info-bg-light: #FFFBEB; /* Yellow-50 */
            --info-border-light: #FCD34D; /* Yellow-400 */
            --info-text-light: #B45309; /* Yellow-800 */
        }
        html.dark {
            --bg-dark: #1E293B; /* Dark slate */
            --text-dark: #CBD5E1; /* Light slate */
            --card-bg-dark: #334155; /* Darker slate */
            --border-dark: #475569; /* Slate-600 */
            --input-bg-dark: #1F2937; /* Gray-800 */
            --primary-btn-bg-dark: #0F766E; /* Darker Teal */
            --primary-btn-hover-dark: #0D9488; /* Teal-600 */
            --secondary-btn-bg-dark: #475569; /* Slate-600 */
            --secondary-btn-text-dark: #CBD5E1;
            --secondary-btn-hover-dark: #64748B; /* Slate-500 */
            --tab-active-bg-dark: #0F766E;
            --tab-active-text-dark: #FFFFFF;
            --tab-hover-dark: #374755; /* Custom dark hover */
            --loader-border-top-dark: #0D9488;
            --success-text-dark: #86EFAC; /* Green-300 */
            --error-text-dark: #F87171; /* Red-400 */
            --info-bg-dark: #422006; /* Custom dark yellow-ish */
            --info-border-dark: #A16207; /* Orange-700 */
            --info-text-dark: #FDE68A; /* Yellow-200 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s;
        }
        html.dark body {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .bg-white { background-color: var(--card-bg-light); }
        html.dark .bg-white { background-color: var(--card-bg-dark); }

        .border-stone-300 { border-color: var(--border-light); }
        html.dark .border-stone-300 { border-color: var(--border-dark); }
        .bg-stone-50 { background-color: var(--input-bg-light); }
        html.dark .bg-stone-50 { background-color: var(--input-bg-dark); }
        .border-stone-200 { border-color: var(--border-light); }
        html.dark .border-stone-200 { border-color: var(--border-dark); }

        .text-stone-600 { color: var(--text-light); } /* Slightly lighter for secondary text */
        html.dark .text-stone-600 { color: var(--text-dark); }

        .text-teal-700 { color: var(--primary-btn-bg-light); } /* Main accent color for headings */
        html.dark .text-teal-700 { color: var(--primary-btn-bg-light); } /* Keep teal for headings even in dark mode */
        .text-teal-800 { color: var(--primary-btn-hover-light); }
        html.dark .text-teal-800 { color: var(--primary-btn-hover-light); }


        .bg-teal-600 { background-color: var(--primary-btn-bg-light); }
        .bg-teal-600:hover { background-color: var(--primary-btn-hover-light); }
        html.dark .bg-teal-600 { background-color: var(--primary-btn-bg-dark); }
        html.dark .bg-teal-600:hover { background-color: var(--primary-btn-hover-dark); }

        .bg-stone-200 { background-color: var(--secondary-btn-bg-light); }
        .text-stone-700 { color: var(--secondary-btn-text-light); }
        .bg-stone-200:hover { background-color: var(--secondary-btn-hover-light); }
        html.dark .bg-stone-200 { background-color: var(--secondary-btn-bg-dark); }
        html.dark .text-stone-700 { color: var(--secondary-btn-text-dark); }
        html.dark .bg-stone-200:hover { background-color: var(--secondary-btn-hover-dark); }

        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            background-color: var(--tab-active-bg-light);
            color: var(--tab-active-text-light);
            font-weight: 600;
        }
        html.dark .tab-btn.active {
            background-color: var(--tab-active-bg-dark);
            color: var(--tab-active-text-dark);
        }
        .tab-btn:not(.active):hover {
            background-color: var(--tab-hover-light);
        }
        html.dark .tab-btn:not(.active):hover {
            background-color: var(--tab-hover-dark);
        }
        .tab-btn {
            color: var(--secondary-btn-text-light);
        }
        html.dark .tab-btn {
            color: var(--secondary-btn-text-dark);
        }

        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .loader {
            border: 4px solid var(--border-light);
            border-top: 4px solid var(--loader-border-top-light);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        html.dark .loader {
            border-color: var(--border-dark);
            border-top-color: var(--loader-border-top-dark);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .text-green-600 { color: var(--success-text-light); }
        html.dark .text-green-600 { color: var(--success-text-dark); }
        .text-red-600 { color: var(--error-text-light); }
        html.dark .text-red-600 { color: var(--error-text-dark); }
        .border-red-500 { border-color: var(--error-text-light); }
        html.dark .border-red-500 { border-color: var(--error-text-dark); }
        .border-green-500 { border-color: var(--success-text-light); }
        html.dark .border-green-500 { border-color: var(--success-text-dark); }

        /* Custom style for dictionary results background */
        .bg-teal-50 { background-color: #F0FDFA; } /* Tailwind teal-50 */
        html.dark .bg-teal-50 { background-color: #2F4259; } /* Custom dark variant for accent background */
        .border-teal-500 { border-color: #14B8A6; } /* Tailwind teal-500 */
        html.dark .border-teal-500 { border-color: #0D9488; } /* Tailwind teal-600 for dark mode border */

        .bg-yellow-50 { background-color: var(--info-bg-light); }
        .border-yellow-500 { border-color: var(--info-border-light); }
        .text-yellow-800 { color: var(--info-text-light); }
        html.dark .bg-yellow-50 { background-color: var(--info-bg-dark); }
        html.dark .border-yellow-500 { border-color: var(--info-border-dark); }
        html.dark .text-yellow-800 { color: var(--info-text-dark); }

    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 relative">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-700">C√¥ng c·ª• Ng√¥n ng·ªØ √äƒë√™-Vi·ªát</h1>
            <p class="mt-2 text-lg text-stone-600">Kh√°m ph√°, d·ªãch thu·∫≠t v√† h·ªçc t·∫≠p ng√¥n ng·ªØ √äƒë√™ m·ªôt c√°ch to√†n di·ªán.</p>
            <button id="theme-toggle" class="absolute top-0 right-0 p-2 rounded-full bg-stone-200 text-stone-700 hover:bg-stone-300 transition shadow-md">
                üåô
            </button>
        </header>

        <main>
            <div class="bg-white/70 backdrop-blur-sm rounded-xl shadow-lg p-4 mb-8">
                <nav id="tabs" class="flex flex-wrap justify-center gap-2 md:gap-4">
                    <button data-tab="translate" class="tab-btn active px-4 py-2 rounded-lg text-sm md:text-base font-medium">üìñ T·ª´ ƒëi·ªÉn & D·ªãch thu·∫≠t</button>
                    <button data-tab="ocr" class="tab-btn px-4 py-2 rounded-lg text-sm md:text-base font-medium">üì∏ D·ªãch H√¨nh ·∫£nh</button>
                    <button data-tab="generate" class="tab-btn px-4 py-2 rounded-lg text-sm md:text-base font-medium">‚úçÔ∏è H·ªçc t·∫≠p & S√°ng t·∫°o</button>
                    <button data-tab="practice" class="tab-btn px-4 py-2 rounded-lg text-sm md:text-base font-medium">üß† Luy·ªán t·∫≠p</button>
                </nav>
            </div>

            <div id="tab-contents">
                <!-- Tab 1: Translate -->
                <section id="translate" class="tab-content active">
                    <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                        <p class="text-stone-600 mb-6 text-center">Nh·∫≠p m·ªôt t·ª´ ho·∫∑c c·ª•m t·ª´ ƒë·ªÉ tra c·ª©u trong t·ª´ ƒëi·ªÉn v√† d·ªãch t·ª± ƒë·ªông. C√°c t·ª´ c√≥ trong t·ª´ ƒëi·ªÉn s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã k·∫øt qu·∫£ chi ti·∫øt b√™n d∆∞·ªõi.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                            <div class="flex flex-col">
                                <label id="label-lang-1" for="text-input" class="mb-2 font-semibold text-teal-700">Ti·∫øng √äƒë√™</label>
                                <textarea id="text-input" rows="5" class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition bg-stone-50" placeholder="Nh·∫≠p vƒÉn b·∫£n ti·∫øng √äƒë√™..."></textarea>
                            </div>
                            <div class="flex flex-col">
                                <label id="label-lang-2" for="text-output" class="mb-2 font-semibold text-teal-700">Ti·∫øng Vi·ªát</label>
                                <textarea id="text-output" rows="5" class="w-full p-3 border border-stone-300 rounded-lg bg-stone-50 focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition" readonly placeholder="B·∫£n d·ªãch s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y..."></textarea>
                            </div>
                        </div>
                         <div class="text-center my-4">
                            <button id="swap-lang-btn" class="px-4 py-2 bg-stone-200 text-stone-700 rounded-lg hover:bg-stone-300 transition duration-300">
                                &#8644; ƒê·∫£o chi·ªÅu
                            </button>
                        </div>
                        <div id="dictionary-results" class="mt-6"></div>
                    </div>
                </section>

                <!-- Tab 2: OCR -->
                <section id="ocr" class="tab-content">
                    <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 text-center">
                        <h3 class="text-xl font-semibold mb-2 text-teal-800">D·ªãch vƒÉn b·∫£n t·ª´ H√¨nh ·∫£nh</h3>
                        <p class="text-stone-600 mb-6">T·∫£i l√™n m·ªôt h√¨nh ·∫£nh ch·ª©a vƒÉn b·∫£n ti·∫øng √äƒë√™ ƒë·ªÉ h·ªá th·ªëng nh·∫≠n d·∫°ng v√† d·ªãch t·ª± ƒë·ªông.</p>
                        <div class="flex justify-center items-center">
                            <label for="ocr-upload" class="cursor-pointer bg-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-teal-700 transition shadow-md">
                                üì§ Ch·ªçn ·∫£nh ƒë·ªÉ t·∫£i l√™n
                            </label>
                            <input type="file" id="ocr-upload" class="hidden" accept="image/*">
                        </div>
                        <div id="ocr-processing" class="mt-8 hidden">
                            <div class="flex justify-center items-center flex-col">
                                <div class="loader"></div>
                                <p class="mt-4 text-stone-600">ƒêang x·ª≠ l√Ω h√¨nh ·∫£nh...</p>
                            </div>
                        </div>
                        <div id="ocr-results" class="mt-8 hidden text-left grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-lg mb-2 text-teal-700">VƒÉn b·∫£n nh·∫≠n d·∫°ng (√äƒë√™)</h4>
                                <textarea id="ocr-text-ede" class="w-full p-4 bg-stone-50 rounded-lg border border-stone-200 min-h-[150px]" readonly></textarea>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg mb-2 text-teal-700">VƒÉn b·∫£n d·ªãch (Vi·ªát)</h4>
                                <textarea id="ocr-text-viet" class="w-full p-4 bg-stone-50 rounded-lg border border-stone-200 min-h-[150px]" readonly></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Tab 3: Generate -->
                <section id="generate" class="tab-content">
                    <div class="space-y-8">
                        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                            <h3 class="text-xl font-semibold mb-2 text-teal-800">T·∫°o c√¢u v√≠ d·ª•</h3>
                            <p class="text-stone-600 mb-6">Nh·∫≠p m·ªôt t·ª´ ti·∫øng √äƒë√™, h·ªá th·ªëng s·∫Ω t·∫°o m·ªôt c√¢u v√≠ d·ª• ho√†n ch·ªânh v√† d·ªãch sang ti·∫øng Vi·ªát ƒë·ªÉ b·∫°n hi·ªÉu r√µ h∆°n v·ªÅ ng·ªØ c·∫£nh s·ª≠ d·ª•ng.</p>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <input type="text" id="example-word-input" class="flex-grow p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-teal-500 bg-stone-50" placeholder="Nh·∫≠p m·ªôt t·ª´ √äƒë√™ (v√≠ d·ª•: sang)">
                                <button id="generate-example-btn" class="bg-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-teal-700 transition shadow-md">T·∫°o v√≠ d·ª•</button>
                            </div>
                            <div id="example-processing" class="mt-4 hidden text-center">
                                <div class="loader mx-auto"></div>
                                <p class="mt-2 text-stone-600">ƒêang t·∫°o v√≠ d·ª•...</p>
                            </div>
                            <div id="example-result" class="mt-6 hidden"></div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                            <h3 class="text-xl font-semibold mb-2 text-teal-800">Vi·∫øt ƒëo·∫°n vƒÉn</h3>
                            <p class="text-stone-600 mb-6">Nh·∫•n n√∫t ƒë·ªÉ t·∫°o m·ªôt ƒëo·∫°n vƒÉn ng·∫Øn (g·ªìm 3 ph·∫ßn: m·ªü, th√¢n, k·∫øt) b·∫±ng ti·∫øng √äƒë√™ c√πng v·ªõi b·∫£n d·ªãch ti·∫øng Vi·ªát. ƒê√¢y l√† c√¥ng c·ª• h·ªØu √≠ch ƒë·ªÉ luy·ªán ƒë·ªçc hi·ªÉu v√† c·∫£m th·ª• vƒÉn phong.</p>
                            <div class="text-center">
                                <button id="generate-paragraph-btn" class="bg-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-teal-700 transition shadow-md">T·∫°o ƒëo·∫°n vƒÉn m·ªõi</button>
                            </div>
                            <div id="paragraph-processing" class="mt-4 hidden text-center">
                                <div class="loader mx-auto"></div>
                                <p class="mt-2 text-stone-600">ƒêang t·∫°o ƒëo·∫°n vƒÉn...</p>
                            </div>
                            <div id="paragraph-result" class="mt-6 hidden"></div>
                        </div>
                    </div>
                </section>

                <!-- Tab 4: Practice -->
                <section id="practice" class="tab-content">
                    <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                        <h3 class="text-xl font-semibold mb-4 text-center text-teal-800">Luy·ªán t·∫≠p ng√¥n ng·ªØ</h3>
                        <p class="text-stone-600 mb-6 text-center">Ch·ªçn m·ªôt d·∫°ng b√†i t·∫≠p ƒë·ªÉ c·ªßng c·ªë ki·∫øn th·ª©c c·ªßa b·∫°n. H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o c√¢u h·ªèi ng·∫´u nhi√™n.</p>
                        <div class="flex justify-center items-center gap-4 mb-8">
                            <label for="exercise-type" class="font-semibold text-stone-700">D·∫°ng b√†i t·∫≠p:</label>
                            <select id="exercise-type" class="p-2 border border-stone-300 rounded-lg bg-stone-50 text-stone-700">
                                <option value="fill-blank">ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng</option>
                                <option value="scramble">S·∫Øp x·∫øp l·∫°i c√¢u</option>
                            </select>
                        </div>
                        <div id="exercise-area" class="bg-stone-50 p-6 rounded-lg border border-stone-200">
                            <div id="question-container" class="text-stone-700"></div>
                            <div class="mt-4 flex flex-col sm:flex-row gap-4">
                                <input type="text" id="answer-input" class="flex-grow p-3 border border-stone-300 rounded-lg bg-stone-50" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n...">
                                <button id="check-answer-btn" class="bg-teal-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-teal-700 transition shadow-md">Ki·ªÉm tra</button>
                            </div>
                            <div id="feedback-area" class="mt-4 font-medium"></div>
                        </div>
                         <div class="text-center mt-6">
                            <button id="new-question-btn" class="px-5 py-2 bg-stone-200 text-stone-700 rounded-lg hover:bg-stone-300 transition shadow-md">C√¢u h·ªèi m·ªõi</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
        
        <footer class="text-center mt-12 text-stone-500 text-sm">
            <p>&copy; 2025 - C√¥ng c·ª• Ng√¥n ng·ªØ √äƒë√™-Vi·ªát. ƒê∆∞·ª£c ph√°t tri·ªÉn d·ª±a tr√™n t√†i li·ªáu nghi√™n c·ª©u.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dictionary = [
                { ede: "Abao", pos: "dt", viet: "·ªêc b∆∞∆°u." },
                { ede: "AbƒÉn", pos: "dt", viet: "C√°i chƒÉn (m·ªÅn)." },
                { ede: "Adei", pos: "dt", viet: "Em." },
                { ede: "Adhan", pos: "dt", viet: "C√†nh." },
                { ede: "Adi√™", pos: "dt", viet: "Tr·ªùi." },
                { ede: "Ad√¥k", pos: "ƒëgt", viet: "C√≤n." },
                { ede: "Ama", pos: "dt", viet: "B·ªë, cha." },
                { ede: "Sang", pos: "dt", viet: "Nh√†." },
                { ede: "Bl≈≠", pos: "ƒëgt", viet: "N√≥i." },
                { ede: "M√±ƒÉ", pos: "ƒëgt", viet: "ƒÇn." },
                { ede: "√äa", pos: "dt", viet: "N∆∞·ªõc." },
                { ede: "HriƒÉm", pos: "ƒëgt", viet: "H·ªçc." },
                { ede: "Klei", pos: "dt", viet: "L·ªùi, ti·∫øng." }
            ];

            const exercises = {
                'fill-blank': [
                    { question: "Adi√™ __.", answer: "hjan", full: "Adi√™ hjan." },
                    { question: "K√¢o __ klei √äƒë√™.", answer: "hriƒÉm", full: "K√¢o hriƒÉm klei √äƒë√™." },
                    { question: "Ama k√¢o m√¢o sa boh __.", answer: "sang", full: "Ama k√¢o m√¢o sa boh sang." }
                ],
                'scramble': [
                    { question: "k√¢o / Sang / anƒÉp / ti", answer: "Sang k√¢o ti anƒÉp.", hint: "Nh√† t√¥i ·ªü ƒë·∫±ng tr∆∞·ªõc." },
                    { question: "m√±ƒÉ / K√¢o / k∆°m∆°i", answer: "K√¢o m√±ƒÉ k∆°m∆°i.", hint: "T√¥i ƒÉn c∆°m." }
                ]
            };
            
            let currentExercise = null;
            let sourceLangIsEde = true;

            const htmlElement = document.documentElement;
            const themeToggleBtn = document.getElementById('theme-toggle');
            const tabs = document.getElementById('tabs');
            const contents = document.getElementById('tab-contents').children;
            const textInput = document.getElementById('text-input');
            const textOutput = document.getElementById('text-output');
            const dictionaryResults = document.getElementById('dictionary-results');
            const swapLangBtn = document.getElementById('swap-lang-btn');
            const labelLang1 = document.getElementById('label-lang-1');
            const labelLang2 = document.getElementById('label-lang-2');

            const ocrUpload = document.getElementById('ocr-upload');
            const ocrProcessing = document.getElementById('ocr-processing');
            const ocrResults = document.getElementById('ocr-results');
            const ocrTextEde = document.getElementById('ocr-text-ede');
            const ocrTextViet = document.getElementById('ocr-text-viet');

            const generateExampleBtn = document.getElementById('generate-example-btn');
            const exampleWordInput = document.getElementById('example-word-input');
            const exampleResult = document.getElementById('example-result');
            const exampleProcessing = document.getElementById('example-processing');

            const generateParagraphBtn = document.getElementById('generate-paragraph-btn');
            const paragraphResult = document.getElementById('paragraph-result');
            const paragraphProcessing = document.getElementById('paragraph-processing');

            const exerciseType = document.getElementById('exercise-type');
            const questionContainer = document.getElementById('question-container');
            const answerInput = document.getElementById('answer-input');
            const checkAnswerBtn = document.getElementById('check-answer-btn');
            const feedbackArea = document.getElementById('feedback-area');
            const newQuestionBtn = document.getElementById('new-question-btn');

            // Theme initialization
            const currentTheme = localStorage.getItem('theme') || 'light';
            if (currentTheme === 'dark') {
                htmlElement.classList.add('dark');
                themeToggleBtn.textContent = '‚òÄÔ∏è';
            } else {
                htmlElement.classList.remove('dark');
                themeToggleBtn.textContent = 'üåô';
            }

            themeToggleBtn.addEventListener('click', () => {
                if (htmlElement.classList.contains('dark')) {
                    htmlElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    themeToggleBtn.textContent = 'üåô';
                } else {
                    htmlElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                    themeToggleBtn.textContent = '‚òÄÔ∏è';
                }
            });

            const switchTab = (tabName) => {
                for (const btn of tabs.children) {
                    btn.classList.toggle('active', btn.dataset.tab === tabName);
                }
                for (const content of contents) {
                    content.classList.toggle('active', content.id === tabName);
                }
            };
            
            tabs.addEventListener('click', (e) => {
                if (e.target.matches('.tab-btn')) {
                    switchTab(e.target.dataset.tab);
                }
            });

            // API Configuration (IMPORTANT: In a real app, API keys should be handled securely, e.g., via backend or environment variables)
            const API_KEY = "AIzaSyBVCTx8fPnGWFprwoT9bgixio_NUgvNG4k"; // Canvas s·∫Ω t·ª± ƒë·ªông cung c·∫•p trong th·ªùi gian ch·∫°y
            const TEXT_GENERATION_MODEL = "gemini-2.5-flash-preview-05-20";
            const IMAGE_UNDERSTANDING_MODEL = "gemini-2.5-flash-preview-05-20"; // D√†nh cho OCR

            // Helper function for API calls with exponential backoff
            async function callGeminiAPI(model, payload) {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`;
                let retries = 0;
                const maxRetries = 5;
                const baseDelay = 1000; // 1 gi√¢y

                while (retries < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                return result.candidates[0].content.parts[0].text;
                            } else {
                                console.error("C·∫•u tr√∫c ph·∫£n h·ªìi API kh√¥ng mong mu·ªën:", result);
                                throw new Error("ƒê·ªãnh d·∫°ng ph·∫£n h·ªìi API kh√¥ng h·ª£p l·ªá.");
                            }
                        } else if (response.status === 429) { // Too Many Requests
                            retries++;
                            const delay = baseDelay * Math.pow(2, retries - 1); // L√πi l≈©y th·ª´a
                            await new Promise(res => setTimeout(res, delay));
                            console.warn(`Th·ª≠ l·∫°i ${retries}/${maxRetries} sau ${delay}ms cho API ${model}.`);
                        } else {
                            const errorData = await response.json();
                            console.error(`L·ªói API (${response.status}):`, errorData);
                            throw new Error(`API tr·∫£ v·ªÅ tr·∫°ng th√°i ${response.status}: ${errorData.error.message}`);
                        }
                    } catch (error) {
                        console.error("L·ªói khi g·ªçi API Gemini:", error);
                        throw error; // N√©m l·∫°i ƒë·ªÉ h√†m g·ªçi c√≥ th·ªÉ b·∫Øt
                    }
                }
                throw new Error("ƒê√£ v∆∞·ª£t qu√° s·ªë l·∫ßn th·ª≠ l·∫°i t·ªëi ƒëa cho cu·ªôc g·ªçi API.");
            }

            const translate = (text, fromEde) => {
                const lowerText = text.toLowerCase().trim();
                if (!lowerText) return { translation: '', dictEntry: null };

                let dictEntry = null;
                if (fromEde) {
                    dictEntry = dictionary.find(entry => entry.ede.toLowerCase() === lowerText);
                } else {
                    dictEntry = dictionary.find(entry => entry.viet.toLowerCase().includes(lowerText));
                }

                if (dictEntry) {
                    return {
                        translation: fromEde ? dictEntry.viet : dictEntry.ede,
                        dictEntry: dictEntry
                    };
                }
                return {
                    translation: fromEde ? "[Kh√¥ng t√¨m th·∫•y b·∫£n d·ªãch ch√≠nh x√°c, c√≥ th·ªÉ tra m·∫°ng]" : "[Kh√¥ng t√¨m th·∫•y b·∫£n d·ªãch ch√≠nh x√°c, c√≥ th·ªÉ tra m·∫°ng]",
                    dictEntry: null
                };
            };
            
            const updateTranslationUI = () => {
                const input = textInput.value;
                const { translation, dictEntry } = translate(input, sourceLangIsEde);
                textOutput.value = translation;

                dictionaryResults.innerHTML = '';
                if (dictEntry) {
                    // Hi·ªÉn th·ªã ƒë∆°n gi·∫£n: ch·ªâ t·ª´ v√† nghƒ©a
                    dictionaryResults.innerHTML = `
                        <div class="bg-teal-50 border-l-4 border-teal-500 p-4 rounded-r-lg">
                            <h4 class="font-bold text-lg text-teal-800">${dictEntry.ede}</h4>
                            <p class="text-stone-700">${dictEntry.viet}</p>
                        </div>
                    `;
                } else if (input.trim() !== '') {
                     dictionaryResults.innerHTML = `
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-r-lg text-yellow-800">
                            <p>Kh√¥ng t√¨m th·∫•y "${input}" trong t·ª´ ƒëi·ªÉn m·∫´u. Vui l√≤ng th·ª≠ t·ª´ kh√°c ho·∫∑c tra c·ª©u tr√™n m·∫°ng.</p>
                        </div>
                    `;
                }
            };
            
            textInput.addEventListener('input', updateTranslationUI);

            swapLangBtn.addEventListener('click', () => {
                sourceLangIsEde = !sourceLangIsEde;
                const tempLabel = labelLang1.textContent;
                labelLang1.textContent = labelLang2.textContent;
                labelLang2.textContent = tempLabel;
                
                const tempPlaceholder = textInput.placeholder;
                textInput.placeholder = textOutput.placeholder.includes('B·∫£n d·ªãch') ? 'Nh·∫≠p vƒÉn b·∫£n ti·∫øng Vi·ªát...' : 'Nh·∫≠p vƒÉn b·∫£n ti·∫øng √äƒë√™...';
                textOutput.placeholder = tempPlaceholder.includes('Nh·∫≠p vƒÉn b·∫£n ti·∫øng √äƒë√™') ? 'B·∫£n d·ªãch s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y...' : 'B·∫£n d·ªãch s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y...';

                const tempValue = textInput.value;
                textInput.value = textOutput.value.startsWith('[') ? '' : textOutput.value;
                textOutput.value = tempValue;
                updateTranslationUI();
            });

            ocrUpload.addEventListener('change', async () => {
                if (ocrUpload.files && ocrUpload.files[0]) {
                    ocrResults.classList.add('hidden');
                    ocrProcessing.classList.remove('hidden');
                    ocrUpload.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t trong khi x·ª≠ l√Ω

                    const file = ocrUpload.files[0];
                    const reader = new FileReader();

                    reader.onload = async (e) => {
                        const base64ImageData = e.target.result.split(',')[1]; // L·∫•y d·ªØ li·ªáu base64

                        try {
                            // --- ƒêI·ªÇM T√çCH H·ª¢P G·ªåI API ƒê·ªÇ HI·ªÇU H√åNH ·∫¢NH ---
                            // G·ª£i √Ω: AI s·∫Ω nh·∫≠n d·∫°ng v√† d·ªãch vƒÉn b·∫£n trong ·∫£nh.
                            const prompt = "Nh·∫≠n d·∫°ng vƒÉn b·∫£n trong h√¨nh ·∫£nh n√†y. N·∫øu c√≥ vƒÉn b·∫£n ti·∫øng √äƒë√™, h√£y d·ªãch sang ti·∫øng Vi·ªát. Tr·∫£ v·ªÅ c·∫£ vƒÉn b·∫£n g·ªëc v√† b·∫£n d·ªãch.";
                            const payload = {
                                contents: [
                                    {
                                        role: "user",
                                        parts: [
                                            { text: prompt },
                                            {
                                                inlineData: {
                                                    mimeType: file.type,
                                                    data: base64ImageData
                                                }
                                            }
                                        ]
                                    }
                                ],
                            };
                            // Gi·∫£ l·∫≠p ph·∫£n h·ªìi API, trong th·ª±c t·∫ø s·∫Ω l·∫•y t·ª´ callGeminiAPI
                            const apiResponseText = await callGeminiAPI(IMAGE_UNDERSTANDING_MODEL, payload);
                            // C·∫ßn m·ªôt parser m·∫°nh h∆°n ƒë·ªÉ t√°ch vƒÉn b·∫£n g·ªëc v√† b·∫£n d·ªãch t·ª´ apiResponseText
                            // V√≠ d·ª• ƒë∆°n gi·∫£n:
                            const recognizedEdeText = "K√¢o hriƒÉm klei √äƒë√™."; // ƒê√¢y s·∫Ω l√† k·∫øt qu·∫£ nh·∫≠n d·∫°ng th·ª±c t·∫ø t·ª´ API
                            const translatedVietText = "T√¥i h·ªçc ti·∫øng √äƒë√™."; // ƒê√¢y s·∫Ω l√† k·∫øt qu·∫£ d·ªãch th·ª±c t·∫ø t·ª´ API
                            // --- K·∫æT TH√öC ƒêI·ªÇM T√çCH H·ª¢P G·ªåI API ---

                            ocrTextEde.value = recognizedEdeText;
                            ocrTextViet.value = translatedVietText;
                            ocrResults.classList.remove('hidden');
                        } catch (error) {
                            console.error("L·ªói trong qu√° tr√¨nh OCR:", error);
                            ocrTextEde.value = "L·ªói khi x·ª≠ l√Ω h√¨nh ·∫£nh.";
                            ocrTextViet.value = "Error processing image.";
                            ocrResults.classList.remove('hidden');
                        } finally {
                            ocrProcessing.classList.add('hidden');
                            ocrUpload.disabled = false; // K√≠ch ho·∫°t l·∫°i n√∫t
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });

            generateExampleBtn.addEventListener('click', async () => {
                const word = exampleWordInput.value.trim();
                if (!word) {
                    exampleResult.innerHTML = `<p class="text-red-600">Vui l√≤ng nh·∫≠p m·ªôt t·ª´ ƒë·ªÉ t·∫°o v√≠ d·ª•.</p>`;
                    exampleResult.classList.remove('hidden');
                    return;
                }

                exampleResult.classList.add('hidden');
                exampleProcessing.classList.remove('hidden');
                generateExampleBtn.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t

                try {
                    // --- ƒêI·ªÇM T√çCH H·ª¢P G·ªåI API ƒê·ªÇ T·∫†O V√ç D·ª§ ---
                    const prompt = `T·∫°o m·ªôt c√¢u v√≠ d·ª• ti·∫øng √äƒë√™ s·ª≠ d·ª•ng t·ª´ "${word}" v√† d·ªãch c√¢u ƒë√≥ sang ti·∫øng Vi·ªát. Tr·∫£ v·ªÅ d∆∞·ªõi d·∫°ng JSON v·ªõi hai tr∆∞·ªùng: "edeSentence" v√† "vietSentence".`;
                    const payload = {
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    "edeSentence": { "type": "STRING" },
                                    "vietSentence": { "type": "STRING" }
                                }
                            }
                        }
                    };
                    const apiResponse = await callGeminiAPI(TEXT_GENERATION_MODEL, payload);
                    const parsedResponse = JSON.parse(apiResponse);
                    // --- K·∫æT TH√öC ƒêI·ªÇM T√çCH H·ª¢P G·ªåI API ---

                    const edeSentence = parsedResponse.edeSentence || `[Kh√¥ng th·ªÉ t·∫°o c√¢u v√≠ d·ª• cho "${word}"]`;
                    const vietSentence = parsedResponse.vietSentence || `[Kh√¥ng th·ªÉ d·ªãch c√¢u v√≠ d·ª• cho "${word}"]`;

                    exampleResult.innerHTML = `
                        <div class="bg-stone-50 p-4 rounded-lg border">
                            <p class="text-lg"><span class="font-semibold text-teal-700">√äƒë√™:</span> ${edeSentence}</p>
                            <p class="text-lg mt-2"><span class="font-semibold text-teal-700">Vi·ªát:</span> ${vietSentence}</p>
                        </div>`;
                } catch (error) {
                    console.error("L·ªói khi t·∫°o v√≠ d·ª•:", error);
                    exampleResult.innerHTML = `<p class="text-red-600">L·ªói khi t·∫°o v√≠ d·ª•. Vui l√≤ng th·ª≠ l·∫°i.</p>`;
                } finally {
                    exampleProcessing.classList.add('hidden');
                    exampleResult.classList.remove('hidden');
                    generateExampleBtn.disabled = false; // K√≠ch ho·∫°t l·∫°i n√∫t
                }
            });

            generateParagraphBtn.addEventListener('click', async () => {
                paragraphResult.classList.add('hidden');
                paragraphProcessing.classList.remove('hidden');
                generateParagraphBtn.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t

                try {
                    // --- ƒêI·ªÇM T√çCH H·ª¢P G·ªåI API ƒê·ªÇ T·∫†O ƒêO·∫†N VƒÇN ---
                    const prompt = `Vi·∫øt m·ªôt ƒëo·∫°n vƒÉn ng·∫Øn (kho·∫£ng 3 ph·∫ßn: m·ªü b√†i, th√¢n b√†i, k·∫øt lu·∫≠n) b·∫±ng ti·∫øng √äƒë√™ v·ªÅ ch·ªß ƒë·ªÅ h·ªçc ng√¥n ng·ªØ, sau ƒë√≥ d·ªãch ƒëo·∫°n vƒÉn ƒë√≥ sang ti·∫øng Vi·ªát. Tr·∫£ v·ªÅ d∆∞·ªõi d·∫°ng JSON v·ªõi hai tr∆∞·ªùng: "edeParagraph" v√† "vietParagraph".`;
                    const payload = {
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    "edeParagraph": { "type": "STRING" },
                                    "vietParagraph": { "type": "STRING" }
                                }
                            }
                        }
                    };
                    const apiResponse = await callGeminiAPI(TEXT_GENERATION_MODEL, payload);
                    const parsedResponse = JSON.parse(apiResponse);
                    // --- K·∫æT TH√öC ƒêI·ªÇM T√çCH H·ª¢P G·ªåI API ---

                    const edeParagraph = parsedResponse.edeParagraph || `[Kh√¥ng th·ªÉ t·∫°o ƒëo·∫°n vƒÉn ti·∫øng √äƒë√™]`;
                    const vietParagraph = parsedResponse.vietParagraph || `[Kh√¥ng th·ªÉ d·ªãch ƒëo·∫°n vƒÉn ti·∫øng Vi·ªát]`;

                    paragraphResult.innerHTML = `
                        <div class="bg-stone-50 p-4 rounded-lg border space-y-4">
                            <div>
                                <h4 class="font-bold text-teal-700">ƒêo·∫°n vƒÉn √äƒë√™</h4>
                                <p>${edeParagraph}</p>
                            </div>
                            <hr class="border-stone-300 dark:border-stone-600">
                            <div>
                                <h4 class="font-bold text-teal-700">B·∫£n d·ªãch ti·∫øng Vi·ªát</h4>
                                <p>${vietParagraph}</p>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error("L·ªói khi t·∫°o ƒëo·∫°n vƒÉn:", error);
                    paragraphResult.innerHTML = `<p class="text-red-600">L·ªói khi t·∫°o ƒëo·∫°n vƒÉn. Vui l√≤ng th·ª≠ l·∫°i.</p>`;
                } finally {
                    paragraphProcessing.classList.add('hidden');
                    paragraphResult.classList.remove('hidden');
                    generateParagraphBtn.disabled = false; // K√≠ch ho·∫°t l·∫°i n√∫t
                }
            });

            const generateNewQuestion = () => {
                feedbackArea.textContent = '';
                answerInput.value = '';
                answerInput.classList.remove('border-red-500', 'border-green-500');
                const type = exerciseType.value;
                const questions = exercises[type];
                currentExercise = questions[Math.floor(Math.random() * questions.length)];
                
                let questionHTML = '';
                if (type === 'fill-blank') {
                    questionHTML = `<p class="text-lg">ƒêi·ªÅn t·ª´ c√≤n thi·∫øu: <br><strong class="font-mono text-xl">${currentExercise.question}</strong></p>`;
                } else {
                    questionHTML = `<p class="text-lg">S·∫Øp x·∫øp c√°c t·ª´ sau th√†nh c√¢u ho√†n ch·ªânh: <br><strong class="font-mono text-xl">${currentExercise.question}</strong></p>
                    <p class="text-sm text-stone-500 mt-1">G·ª£i √Ω: ${currentExercise.hint}</p>`;
                }
                questionContainer.innerHTML = questionHTML;
            };

            checkAnswerBtn.addEventListener('click', () => {
                const userAnswer = answerInput.value.trim();
                let isCorrect = false;
                if (exerciseType.value === 'fill-blank') {
                    isCorrect = userAnswer.toLowerCase() === currentExercise.answer.toLowerCase();
                } else {
                    isCorrect = userAnswer.toLowerCase().replace(/[.,]/g, '') === currentExercise.answer.toLowerCase().replace(/[.,]/g, '');
                }

                if (isCorrect) {
                    feedbackArea.textContent = 'Ch√≠nh x√°c! C√¢u ho√†n ch·ªânh l√†: ' + (currentExercise.full || currentExercise.answer);
                    feedbackArea.className = 'mt-4 font-medium text-green-600';
                    answerInput.classList.remove('border-red-500');
                    answerInput.classList.add('border-green-500');
                } else {
                    feedbackArea.textContent = 'Ch∆∞a ƒë√∫ng, h√£y th·ª≠ l·∫°i!';
                    feedbackArea.className = 'mt-4 font-medium text-red-600';
                    answerInput.classList.remove('border-green-500');
                    answerInput.classList.add('border-red-500');
                }
            });
            
            newQuestionBtn.addEventListener('click', generateNewQuestion);
            exerciseType.addEventListener('change', generateNewQuestion);

            generateNewQuestion();
        });
    </script>
</body>
</html>
