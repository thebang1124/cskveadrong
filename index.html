<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quản lý địa bàn & đối tượng — Search + Export</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}</style>
</head>
<body class="bg-gray-50 min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <header class="mb-6">
      <h1 class="text-3xl font-bold text-slate-800">Hệ thống Quản lý Địa bàn & Đối tượng</h1>
      <p class="text-slate-600 mt-1">Tìm kiếm nâng cao + Xuất Excel. (Firebase config: dán vào biến firebaseConfig bên dưới)</p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left: controls -->
      <section class="col-span-1 bg-white rounded-xl shadow p-4">
        <h2 class="font-semibold text-lg mb-3">Bộ lọc & hành động</h2>

        <div class="space-y-3">
          <label class="block text-sm text-slate-600">Chọn Thôn/Buôn</label>
          <select id="filter-precinct" class="w-full border rounded px-3 py-2">
            <option value="">-- Tất cả thôn/buôn --</option>
          </select>

          <label class="block text-sm text-slate-600">Tên thành viên (tìm một phần)</label>
          <input id="filter-name" class="w-full border rounded px-3 py-2" placeholder="Nhập họ tên" />

          <label class="block text-sm text-slate-600">CCCD thành viên</label>
          <input id="filter-cccd" class="w-full border rounded px-3 py-2" placeholder="Nhập CCCD" />

          <label class="block text-sm text-slate-600">CCCD chủ hộ</label>
          <input id="filter-head-cccd" class="w-full border rounded px-3 py-2" placeholder="Nhập CCCD chủ hộ" />

          <div class="flex gap-2">
            <button id="btn-search" class="flex-1 bg-indigo-600 text-white rounded px-3 py-2">Tìm kiếm</button>
            <button id="btn-reset" class="flex-1 border rounded px-3 py-2">Đặt lại</button>
          </div>

          <div class="pt-3 border-t"></div>

          <button id="export-households" class="w-full bg-blue-600 text-white rounded px-3 py-2">Xuất danh sách Hộ (Excel)</button>
          <button id="export-members" class="w-full bg-green-600 text-white rounded px-3 py-2">Xuất danh sách Thành viên (Excel)</button>

        </div>
      </section>

      <!-- Middle: precinct list -->
      <section class="col-span-1 lg:col-span-2">
        <div class="bg-white rounded-xl shadow p-4 mb-4">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold text-lg">Danh sách Thôn/Buôn</h2>
            <div class="flex items-center gap-2">
              <button id="btn-add-precinct" class="px-3 py-1 rounded bg-indigo-500 text-white">+ Thêm Thôn</button>
            </div>
          </div>

          <div id="precincts-container" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
        </div>

        <div class="bg-white rounded-xl shadow p-4">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold text-lg">Danh sách Hộ & Thành viên</h2>
            <div class="text-sm text-slate-500">Kết quả lọc: <span id="result-count">0</span></div>
          </div>

          <div id="results" class="mt-4 space-y-3"></div>
        </div>
      </section>
    </main>

    <footer class="mt-6 text-sm text-slate-500">Template bởi ChatGPT — bạn có thể chỉnh firebaseConfig bên dưới và dán vào hosting/serve.</footer>
  </div>

  <!-- Modal (simple) -->
  <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white rounded p-4 w-full max-w-xl">
      <h3 id="modal-title" class="font-semibold mb-2">Modal</h3>
      <div id="modal-body"></div>
      <div class="mt-4 text-right">
        <button id="modal-close" class="px-3 py-1 rounded border">Đóng</button>
      </div>
    </div>
  </div>

  <script type="module">
    import * as XLSX from "https://cdn.sheetjs.com/xlsx-latest/package/xlsx.mjs";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const el = {
      precinctsContainer: document.getElementById('precincts-container'),
      results: document.getElementById('results'),
      filterPrecinct: document.getElementById('filter-precinct'),
      filterName: document.getElementById('filter-name'),
      filterCccd: document.getElementById('filter-cccd'),
      filterHeadCccd: document.getElementById('filter-head-cccd'),
      btnSearch: document.getElementById('btn-search'),
      btnReset: document.getElementById('btn-reset'),
      btnAddPrecinct: document.getElementById('btn-add-precinct'),
      exportHouseholds: document.getElementById('export-households'),
      exportMembers: document.getElementById('export-members'),
      resultCount: document.getElementById('result-count'),
      modal: document.getElementById('modal'),
      modalTitle: document.getElementById('modal-title'),
      modalBody: document.getElementById('modal-body'),
      modalClose: document.getElementById('modal-close')
    };

    let precincts = [];
    let households = {};

    function uid(prefix='id') { return prefix + '_' + Math.random().toString(36).slice(2,9); }

    function showModal(title, html) {
      el.modalTitle.textContent = title;
      el.modalBody.innerHTML = html;
      el.modal.classList.remove('hidden');
    }
    el.modalClose.addEventListener('click', () => el.modal.classList.add('hidden'));

    function downloadExcel(jsonData, filename) {
      const worksheet = XLSX.utils.json_to_sheet(jsonData);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');
      XLSX.writeFile(workbook, filename);
    }

    function renderPrecincts() {
      el.precinctsContainer.innerHTML = '';
      el.filterPrecinct.innerHTML = '<option value="">-- Tất cả thôn/buôn --</option>' + precincts.map(p => `<option value="${p.id}">${p.name}</option>`).join('');

      precincts.forEach(p => {
        const card = document.createElement('div');
        card.className = 'bg-white border rounded-lg p-3 shadow hover:shadow-md transition';
        const countHouseholds = (households[p.id]||[]).length;
        card.innerHTML = `
          <div class="flex items-start justify-between">
            <div>
              <h3 class="font-semibold text-slate-800">${p.name}</h3>
              <p class="text-xs text-slate-500 mt-1">Hộ: ${countHouseholds}</p>
            </div>
            <div class="flex flex-col gap-2">
              <button data-id="${p.id}" class="btn-add-hh px-2 py-1 text-xs border rounded text-green-600">+ Hộ</button>
            </div>
          </div>
        `;
        el.precinctsContainer.appendChild(card);
      });

      document.querySelectorAll('.btn-add-hh').forEach(b => b.addEventListener('click', (ev)=>{
        const pid = ev.currentTarget.getAttribute('data-id');
        const name = prompt("Nhập tên chủ hộ:");
        if (!name) return;
        const cccd = prompt("Nhập số CCCD chủ hộ:");
        if (!cccd) return;
        const hid = uid('hh');
        households[pid].push({ id: hid, name, cccd, members: [] });
        renderPrecincts();
      }));
    }

    function performSearch() {
      const name = el.filterName.value.trim().toLowerCase();
      const cccd = el.filterCccd.value.trim();
      const headCccd = el.filterHeadCccd.value.trim();
      const precinctFilter = el.filterPrecinct.value;

      let results = [];
      precincts.forEach(p=>{
        const hh = households[p.id]||[];
        hh.forEach(h=>{
          if (headCccd && (!h.cccd || !h.cccd.includes(headCccd))) return;
          (h.members||[]).forEach(m=>{
            const matchName = !name || m.name.toLowerCase().includes(name);
            const matchCccd = !cccd || (m.cccd || '').includes(cccd);
            const matchPrec = !precinctFilter || precinctFilter === p.id;
            if (matchName && matchCccd && matchPrec) {
              results.push({ id: m.id, name: m.name, cccd: m.cccd, precinctId: p.id, precinctName: p.name, householdId: h.id, householdName: h.name, headCccd: h.cccd });
            }
          });
        });
      });

      renderResults(results);
      return results;
    }

    function renderResults(list) {
      el.results.innerHTML = '';
      el.resultCount.textContent = list.length;
      if (list.length === 0) {
        el.results.innerHTML = '<p class="text-slate-500">Không tìm thấy kết quả.</p>';
        return;
      }
      list.forEach(item => {
        const card = document.createElement('div');
        card.className = 'bg-gray-50 border rounded p-3 flex items-start justify-between';
        card.innerHTML = `
          <div>
            <div class="font-medium">${item.name}</div>
            <div class="text-xs text-slate-600 mt-1">CCCD: ${item.cccd||'-'} • Chủ hộ CCCD: ${item.headCccd||'-'} • Thôn: ${item.precinctName||'-'} • Hộ: ${item.householdName||'-'}</div>
          </div>
          <div class="text-right">
            <div class="text-xs text-slate-500">ID: ${item.id}</div>
          </div>
        `;
        el.results.appendChild(card);
      });
    }

    function exportHouseholdsExcel() {
      const precinctFilter = el.filterPrecinct.value;
      let rows = [];
      precincts.forEach(p=>{
        if (precinctFilter && precinctFilter !== p.id) return;
        (households[p.id]||[]).forEach(h=> rows.push({ precinct: p.name, householdId: h.id, householdName: h.name, cccd: h.cccd || '', members: h.members?.length || 0 }));
      });
      if (rows.length === 0) return alert('Không có dữ liệu để xuất.');
      downloadExcel(rows, `danh_sach_ho.xlsx`);
    }

    async function seedIfEmpty() {
      precincts = [
        { id: "prec1"; name: "Thôn 5" };
        { id: "prec2"; name: "Thôn 6" };
        { id: "prec3"; name: "Thôn 7" };
        { id: "prec4"; name: "Thôn 8" };
        { id: "prec5"; name: "Thôn 9" };
        { id: "prec6"; name: "Buôn Alê Gŏ" };
        { id: "prec7"; name: "Buôn Dhu" };
        { id: "prec8"; name: "Buôn Ea Kjŏh A" };
        { id: "prec9"; name: "Buôn Ea Kjŏh B" };
        { id: "prec10"; name: "Buôn Hně" };
        { id: "prec11"; name: "Buôn Kmiên" };
        { id: "prec12"; name: "Buôn Pheo" };
        { id: "prec13"; name: "Buôn Sǐng A" };
        { id: "prec14"; name: "Buôn Tung Krăk" };
        { id: "prec15"; name: "Buôn Trang" };
        { id: "prec16"; name: "Buôn Trăp" };
        { id: "prec17"; name: "Buôn Tring 4" };
        { id: "prec18"; name: "Thôn Đông Xuân" };
        { id: "prec19"; name: "Thôn Ea Kung" };
        { id: "prec20"; name: "Buôn Klat A" };
        { id: "prec21"; name: "Buôn Klat B" };
        { id: "prec22"; name: "Buôn Klat C" };
        { id: "prec23"; name: "Thôn Quyết Thắng" };
        { id: "prec24"; name: "Thôn Tân Hợp" };
        { id: "prec25"; name: "Thôn 1A" };
        { id: "prec26"; name: "Thôn 1B" };
        { id: "prec27"; name: "Thôn 2A" };
        { id: "prec28"; name: "Thôn 2B" };
        { id: "prec29"; name: "Thôn 3" };
        { id: "prec30"; name: "Thôn 6" };
        { id: "prec31"; name: "Thôn 7" };
        { id: "prec32"; name: "Thôn 8" };
      ];

      households = {
        "prec1": [
            { "id": "1"; "name": "Y ÑUT NIÊ"; "cccd": "064065002998"; "members": [] };
            { "id": "2"; "name": "Y BLUM NIÊ"; "cccd": "066038002395"; "members": [] };
            { "id": "3"; "name": "Y BLƠR MLÔ"; "cccd": "066045002246"; "members": [] };
            { "id": "4"; "name": "Y KŬT KRIÊNG"; "cccd": "066046002793"; "members": [] };
            { "id": "5"; "name": "Y TAM KBUÔR"; "cccd": "066050004260"; "members": [] };
            { "id": "6"; "name": "Y BLIAH NIÊ"; "cccd": "066052003352"; "members": [] };
            { "id": "7"; "name": "Y BIĂI MLÔ"; "cccd": "066054003769"; "members": [] };
            { "id": "8"; "name": "Y SUÔM MLÔ"; "cccd": "066056002228"; "members": [] };
            { "id": "9"; "name": "Y KHÔN KNUL"; "cccd": "066056003861"; "members": [] };
            { "id": "10"; "name": "Y DHIĂ NIÊ"; "cccd": "066057003265"; "members": [] };
            { "id": "11"; "name": "Y DŎK MLÔ"; "cccd": "066058003424"; "members": [] };
            { "id": "12"; "name": "Y SUÔR MLÔ"; "cccd": "066059003879"; "members": [] };
            { "id": "13"; "name": "Y DƯT MLÔ"; "cccd": "066059005057"; "members": [] };
            { "id": "14"; "name": "Y YƠN NIÊ"; "cccd": "066059005964"; "members": [] };
            { "id": "15"; "name": "Y HIĂL KRIÊNG"; "cccd": "066063002590"; "members": [] };
            { "id": "16"; "name": "Y KUA MLÔ"; "cccd": "066063005023"; "members": [] };
            { "id": "17"; "name": "Y HÔ MLÔ"; "cccd": "066063005550"; "members": [] };
            { "id": "18"; "name": "Y ŇAT NIÊ"; "cccd": "066063005699"; "members": [] };
            { "id": "19"; "name": "Y MRÔK MLÔ"; "cccd": "066064002789"; "members": [] };
            { "id": "20"; "name": "Y THANH KBUÔR"; "cccd": "066065002437"; "members": [] };
            { "id": "21"; "name": "Y HYUR MLÔ"; "cccd": "066065006005"; "members": [] };
            { "id": "22"; "name": "Y SƠ MLÔ"; "cccd": "066066001414"; "members": [] };
            { "id": "23"; "name": "Y BLIÊNG NIÊ"; "cccd": "066066002972"; "members": [] };
            { "id": "24"; "name": "Y WER NIÊ"; "cccd": "066066003402"; "members": [] };
            { "id": "25"; "name": "Y NIH NIÊ"; "cccd": "066066004234"; "members": [] };
            { "id": "26"; "name": "Y JÔŇ KNUL"; "cccd": "066066004335"; "members": [] };
            { "id": "27"; "name": "Y TRĂM KBUÔR"; "cccd": "066066005763"; "members": [] };
            { "id": "28"; "name": "Y DŬK KRIÊNG"; "cccd": "066068002433"; "members": [] };
            { "id": "29"; "name": "Y TRUNG MLÔ"; "cccd": "066069004889"; "members": [] };
            { "id": "30"; "name": "Y PHIM NIÊ"; "cccd": "066069006727"; "members": [] };
            { "id": "31"; "name": "Y BÊ NIÊ"; "cccd": "066070000097"; "members": [] };
            { "id": "32"; "name": "Y JUAR NIÊ KRIÊNG"; "cccd": "066070001375"; "members": [] };
            { "id": "33"; "name": "Y HƠP KSƠR"; "cccd": "066070004070"; "members": [] };
            { "id": "34"; "name": "Y DHƠN NIÊ"; "cccd": "066070005611"; "members": [] };
            { "id": "35"; "name": "Y SEM NIÊ BYĂ"; "cccd": "066070008389"; "members": [] };
            { "id": "36"; "name": "Y THIM MLÔ"; "cccd": "066070008821"; "members": [] };
            { "id": "37"; "name": "Y TÔNG NIÊ"; "cccd": "066071001312"; "members": [] };
            { "id": "38"; "name": "Y GER NIÊ"; "cccd": "066072002670"; "members": [] };
            { "id": "39"; "name": "Y TIÔNG KNUL"; "cccd": "066072005490"; "members": [] };
            { "id": "40"; "name": "Y MREO KRIÊNG"; "cccd": "066072006294"; "members": [] };
            { "id": "41"; "name": "Y BOM MLÔ"; "cccd": "066073007087"; "members": [] };
            { "id": "42"; "name": "Y BLIN MLÔ"; "cccd": "066073008243"; "members": [] };
            { "id": "43"; "name": "Y NIANG KRIÊNG"; "cccd": "066074003281"; "members": [] };
            { "id": "44"; "name": "Y MĂN MLÔ"; "cccd": "066074005498"; "members": [] };
            { "id": "45"; "name": "Y REO NIÊ KDĂM"; "cccd": "066075003878"; "members": [] };
            { "id": "46"; "name": "Y TOM KRIÊNG"; "cccd": "066075005564"; "members": [] };
            { "id": "47"; "name": "Y TRĬ NIÊ"; "cccd": "066075006642"; "members": [] };
            { "id": "48"; "name": "Y LER NIÊ KDĂM"; "cccd": "066075009096"; "members": [] };
            { "id": "49"; "name": "Y GER KNUL"; "cccd": "066075009097"; "members": [] };
            { "id": "50"; "name": "Y MEÑ MLÔ"; "cccd": "066075009839"; "members": [] };
            { "id": "51"; "name": "Y NÊNH NIÊ"; "cccd": "066075009843"; "members": [] };
            { "id": "52"; "name": "Y SƯP NIÊ"; "cccd": "066076010826"; "members": [] };
            { "id": "53"; "name": "Y RUÊN AYŬN"; "cccd": "066076013873"; "members": [] };
            { "id": "54"; "name": "Y NGỌC MLÔ"; "cccd": "066077003390"; "members": [] };
            { "id": "55"; "name": "Y KHOL NIÊ KDĂM"; "cccd": "066077007687"; "members": [] };
            { "id": "56"; "name": "Y BRÔ KRIÊNG"; "cccd": "066077008566"; "members": [] };
            { "id": "57"; "name": "Y MINH KRIÊNG"; "cccd": "066078001775"; "members": [] };
            { "id": "58"; "name": "Y JEK MLÔ"; "cccd": "066078003062"; "members": [] };
            { "id": "59"; "name": "Y KHAÑ KNUL"; "cccd": "066078006629"; "members": [] };
            { "id": "60"; "name": "Y SƠ RENG KNUL"; "cccd": "066079007397"; "members": [] };
            { "id": "61"; "name": "Y THƯ MLÔ"; "cccd": "066079009593"; "members": [] };
            { "id": "62"; "name": "Y MƠI MLÔ"; "cccd": "066079009636"; "members": [] };
            { "id": "63"; "name": "KSOR TƯ"; "cccd": "066079009903"; "members": [] };
            { "id": "64"; "name": "Y PHĂM MLÔ"; "cccd": "066079010291"; "members": [] };
            { "id": "65"; "name": "Y YAI NIÊ"; "cccd": "066080004709"; "members": [] };
            { "id": "66"; "name": "Y RÔM NIÊ"; "cccd": "066080005826"; "members": [] };
            { "id": "67"; "name": "Y PHƯƠNG NIÊ"; "cccd": "066081004825"; "members": [] };
            { "id": "68"; "name": "Y DHUÔN MLÔ"; "cccd": "066081010289"; "members": [] };
            { "id": "69"; "name": "Y TRUÊN MLÔ"; "cccd": "066081011330"; "members": [] };
            { "id": "70"; "name": "Y BUIÑ MLÔ"; "cccd": "066082003445"; "members": [] };
            { "id": "71"; "name": "Y SUÔN NIÊ"; "cccd": "066082005354"; "members": [] };
            { "id": "72"; "name": "Y CHƯƠNG BYĂ"; "cccd": "066082006000"; "members": [] };
            { "id": "73"; "name": "Y KRIĔO NIÊ"; "cccd": "066082009043"; "members": [] };
            { "id": "74"; "name": "Y ÑƠN MLÔ"; "cccd": "066082010053"; "members": [] };
            { "id": "75"; "name": "Y YET KSƠR"; "cccd": "066082012420"; "members": [] };
            { "id": "76"; "name": "Y SƠWEN KNUL"; "cccd": "066084003683"; "members": [] };
            { "id": "77"; "name": "Y KROK MLÔ"; "cccd": "066084015100"; "members": [] };
            { "id": "78"; "name": "Y BLEM MLÔ"; "cccd": "066085005129"; "members": [] };
            { "id": "79"; "name": "Y BEL MLÔ"; "cccd": "066085006884"; "members": [] };
            { "id": "80"; "name": "Y THUYN NIÊ"; "cccd": "066085007472"; "members": [] };
            { "id": "81"; "name": "Y HON NIÊ"; "cccd": "066085016006"; "members": [] };
            { "id": "82"; "name": "Y BHĂC NIÊ"; "cccd": "066086003826"; "members": [] };
            { "id": "83"; "name": "Y KUANG NIÊ"; "cccd": "066086005441"; "members": [] };
            { "id": "84"; "name": "Y KÔN NIÊ"; "cccd": "066086005760"; "members": [] };
            { "id": "85"; "name": "Y YŬNG NIÊ"; "cccd": "066086007182"; "members": [] };
            { "id": "86"; "name": "Y BLIÊNG NIÊ"; "cccd": "066086011932"; "members": [] };
            { "id": "87"; "name": "Y SƠP MLÔ"; "cccd": "066086017182"; "members": [] };
            { "id": "88"; "name": "Y NUĚ MLÔ"; "cccd": "066087004766"; "members": [] };
            { "id": "89"; "name": "Y HIỆP NIÊ"; "cccd": "066087016424"; "members": [] };
            { "id": "90"; "name": "Y BƯP NIÊ"; "cccd": "066087016573"; "members": [] };
            { "id": "91"; "name": "Y PHÚC KSƠR"; "cccd": "066087017563"; "members": [] };
            { "id": "92"; "name": "Y DJƠT KSƠR"; "cccd": "066088008925"; "members": [] };
            { "id": "93"; "name": "Y BLIÊNG BYĂ"; "cccd": "066088011440"; "members": [] };
            { "id": "94"; "name": "Y KIÊM BYĂ"; "cccd": "066088020760"; "members": [] };
            { "id": "95"; "name": "Y KUĬ NIÊ"; "cccd": "066089004792"; "members": [] };
            { "id": "96"; "name": "Y SƠREL KSƠR"; "cccd": "066089008466"; "members": [] };
            { "id": "97"; "name": "Y DUY NIÊ KDĂM"; "cccd": "066089020200"; "members": [] };
            { "id": "98"; "name": "Y PHER MLÔ"; "cccd": "066089020228"; "members": [] };
            { "id": "99"; "name": "Y THƯƠNG MLÔ"; "cccd": "066090008330"; "members": [] };
            { "id": "100"; "name": "Y THUÊL NIÊ"; "cccd": "066091008283"; "members": [] };
            { "id": "101"; "name": "Y PHINH NIÊ KĐĂM"; "cccd": "066091013033"; "members": [] };
            { "id": "102"; "name": "Y PÔL MLÔ"; "cccd": "066092015652"; "members": [] };
            { "id": "103"; "name": "Y ĐHEM MLÔ"; "cccd": "066093023936"; "members": [] };
            { "id": "104"; "name": "Y SI NŬK NIÊ"; "cccd": "066099005383"; "members": [] };
            { "id": "105"; "name": "H DĂ KSƠR"; "cccd": "066128002341"; "members": [] };
            { "id": "106"; "name": "H KIĂP NIÊ"; "cccd": "066140003324"; "members": [] };
            { "id": "107"; "name": "H LUK NIÊ KDĂM"; "cccd": "066146004288"; "members": [] };
            { "id": "108"; "name": "H PEL NIÊ"; "cccd": "066149001457"; "members": [] };
            { "id": "109"; "name": "H WƠT KSƠR"; "cccd": "066149004038"; "members": [] };
            { "id": "110"; "name": "H UAH NIÊ"; "cccd": "066153003322"; "members": [] };
            { "id": "111"; "name": "H RAI NIÊ"; "cccd": "066155004930"; "members": [] };
            { "id": "112"; "name": "H PANG MLÔ"; "cccd": "066160004768"; "members": [] };
            { "id": "113"; "name": "H RĂNG KRIÊNG"; "cccd": "066160004858"; "members": [] };
            { "id": "114"; "name": "H LEK MLÔ"; "cccd": "066163004213"; "members": [] };
            { "id": "115"; "name": "H DJHUEH MLÔ"; "cccd": "066163006674"; "members": [] };
            { "id": "116"; "name": "H GREH KSƠR"; "cccd": "066164005297"; "members": [] };
            { "id": "117"; "name": "H ĐRAO NIÊ"; "cccd": "066164007721"; "members": [] };
            { "id": "118"; "name": "H BLĂ KSƠR"; "cccd": "066169007535"; "members": [] };
            { "id": "119"; "name": "H BA NIÊ"; "cccd": "066173019766"; "members": [] };
            { "id": "120"; "name": "H SLÊNH MLÔ"; "cccd": "066174008275"; "members": [] };
            { "id": "121"; "name": "H MEN NIÊ"; "cccd": "066175007857"; "members": [] };
            { "id": "122"; "name": "H JŬ KRIÊNG"; "cccd": "066176005043"; "members": [] };
            { "id": "123"; "name": "H NƠM MLÔ"; "cccd": "066176008955"; "members": [] };
            { "id": "124"; "name": "H NGEN NIÊ KĐĂM"; "cccd": "066178005355"; "members": [] };
            { "id": "125"; "name": "H ČIN NIÊ"; "cccd": "066180007471"; "members": [] };
            { "id": "126"; "name": "H RON MLÔ"; "cccd": "066181008219"; "members": [] };
            { "id": "127"; "name": "H JUEN KSƠR"; "cccd": "066183005509"; "members": [] };
            { "id": "128"; "name": "H MOAN NIÊ"; "cccd": "066187007604"; "members": [] };
            { "id": "129"; "name": "H LỊCH MLÔ"; "cccd": "066191020781"; "members": [] };
            { "id": "130"; "name": "H WUI NIÊ"; "cccd": "066194022670"; "members": [] };
            { "id": "131"; "name": "H YƠ̆I KRIÊNG"; "cccd": "066195026666"; "members": [] };
            { "id": "132"; "name": "H GEP KRIÊNG"; "cccd": "066195026667"; "members": [] };
            { "id": "133"; "name": "H ÑOEN MLÔ"; "cccd": "066196023362"; "members": [] };
            { "id": "134"; "name": "H ƯNG KSƠR"; "cccd": "066197023397"; "members": [] };
            { "id": "135"; "name": "H THĂN NIÊ"; "cccd": "066300004085"; "members": [] };
            { "id": "136"; "name": "H LUIN NIÊ"; "cccd": "066300014022"; "members": [] };
            { "id": "137"; "name": "DƯƠNG ĐÌNH HÀ"; "cccd": "027093007243"; "members": [] };
            { "id": "138"; "name": "Y PHAN MLÔ"; "cccd": "064063003761"; "members": [] };
            { "id": "139"; "name": "KSƠR LƠI"; "cccd": "066037002334"; "members": [] };
            { "id": "140"; "name": "Y PHIƠI NIÊ"; "cccd": "066044001785"; "members": [] };
            { "id": "141"; "name": "Y PUI NIÊ"; "cccd": "066044002032"; "members": [] };
            { "id": "142"; "name": "Y THIÊP NIÊ"; "cccd": "066044002249"; "members": [] };
            { "id": "143"; "name": "Y KHÊ NIÊ"; "cccd": "066050002585"; "members": [] };
            { "id": "144"; "name": "Y RAI NIÊ"; "cccd": "066055005156"; "members": [] };
            { "id": "145"; "name": "Y ČƯČ NIÊ"; "cccd": "066056005283"; "members": [] };
            { "id": "146"; "name": "Y BHAO MLÔ"; "cccd": "066058000082"; "members": [] };
            { "id": "147"; "name": "Y PHƠI MLÔ"; "cccd": "066059002148"; "members": [] };
            { "id": "148"; "name": "Y KHUI MLÔ"; "cccd": "066060005948"; "members": [] };
            { "id": "149"; "name": "Y DIÊM NIÊ"; "cccd": "066061002014"; "members": [] };
            { "id": "150"; "name": "Y MGRO MLÔ"; "cccd": "066061002900"; "members": [] };
            { "id": "151"; "name": "Y WƠ̆I MLÔ"; "cccd": "066063005498"; "members": [] };
            { "id": "152"; "name": "Y NGĬ MLÔ"; "cccd": "066063005929"; "members": [] };
            { "id": "153"; "name": "Y ĐHIN MLÔ"; "cccd": "066065006070"; "members": [] };
            { "id": "154"; "name": "Y SOAĬ NIÊ"; "cccd": "066066003098"; "members": [] };
            { "id": "155"; "name": "Y NGUÊ NIÊ"; "cccd": "066066003770"; "members": [] };
            { "id": "156"; "name": "Y NGIÊM MLÔ"; "cccd": "066068007773"; "members": [] };
            { "id": "157"; "name": "Y LI MLÔ"; "cccd": "066068008055"; "members": [] };
            { "id": "158"; "name": "Y VEN MLÔ"; "cccd": "066069000071"; "members": [] };
            { "id": "159"; "name": "Y WICH MLÔ"; "cccd": "066069004106"; "members": [] };
            { "id": "160"; "name": "Y THUÔN NIÊ"; "cccd": "066069004334"; "members": [] };
            { "id": "161"; "name": "Y BUÊ NIÊ KDĂM"; "cccd": "066069004832"; "members": [] };
            { "id": "162"; "name": "Y PEM MLÔ"; "cccd": "066069005277"; "members": [] };
            { "id": "163"; "name": "Y BLƯ MLÔ"; "cccd": "066069007310"; "members": [] };
            { "id": "164"; "name": "Y KHAR NIÊ"; "cccd": "066070000096"; "members": [] };
            { "id": "165"; "name": "Y ĐA NIÊ"; "cccd": "066070002923"; "members": [] };
            { "id": "166"; "name": "Y HĂNG NIÊ"; "cccd": "066070003294"; "members": [] };
            { "id": "167"; "name": "Y ČHÔNG MLÔ"; "cccd": "066072004655"; "members": [] };
            { "id": "168"; "name": "Y LIĂ NIÊ"; "cccd": "066072005015"; "members": [] };
            { "id": "169"; "name": "Y NGÔK NIÊ"; "cccd": "066072005345"; "members": [] };
            { "id": "170"; "name": "Y ÑING MLÔ"; "cccd": "066072005633"; "members": [] };
            { "id": "171"; "name": "Y TƯ MLÔ"; "cccd": "066072006384"; "members": [] };
            { "id": "172"; "name": "Y ON MLÔ"; "cccd": "066072008701"; "members": [] };
            { "id": "173"; "name": "Y JON MLÔ"; "cccd": "066073003568"; "members": [] };
            { "id": "174"; "name": "Y DRAI BYĂ"; "cccd": "066073004308"; "members": [] };
            { "id": "175"; "name": "Y WÔL NIÊ"; "cccd": "066073004501"; "members": [] };
            { "id": "176"; "name": "Y ĐŎK MLÔ"; "cccd": "066073005224"; "members": [] };
            { "id": "177"; "name": "Y NEM HRA"; "cccd": "066074002545"; "members": [] };
            { "id": "178"; "name": "Y UIN MLÔ"; "cccd": "066075003321"; "members": [] };
            { "id": "179"; "name": "Y MIK NIÊ"; "cccd": "066075006183"; "members": [] };
            { "id": "180"; "name": "Y SƠMI MLÔ"; "cccd": "066075008434"; "members": [] };
            { "id": "181"; "name": "Y LIÊM MLÔ"; "cccd": "066076008237"; "members": [] };
            { "id": "182"; "name": "Y SEP MLÔ"; "cccd": "066076008339"; "members": [] };
        ],
        "prec2": [
          { id: "H003", name: "Y Wang Niê", cccd: "111222333444", members: [] },
          { id: "H004", name: "H’Mơn Niê", cccd: "555666777888", members: [] }
        ],
        "prec3": [
          { id: "H005", name: "Trần Văn B", cccd: "999888777666", members: [] }
        ]
      };
    }

    (async function init(){
      await seedIfEmpty();
      renderPrecincts();
      el.exportHouseholds.addEventListener('click', exportHouseholdsExcel);
      el.btnSearch.addEventListener('click', performSearch);
      el.btnReset.addEventListener('click', ()=>{
        el.filterPrecinct.value = '';
        el.filterName.value = '';
        el.filterCccd.value = '';
        el.filterHeadCccd.value = '';
        renderResults([]);
      });
    })();
  </script>
</body>
</html>
