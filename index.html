<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>H·ªá Th·ªëng Qu·∫£n L√Ω ƒê·ªãa B√†n & ƒê·ªëi T∆∞·ª£ng (B·∫£n ho√†n ch·ªânh ƒë√£ s·ª≠a)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <style>
    body { font-family: 'Inter', sans-serif; transition: background-color .3s, color .3s }
    .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,.5); justify-content:center; align-items:center }
    .hidden{display:none}
    .tab-button{transition:all .2s ease-in-out; border-bottom-width:2px; border-bottom-color:transparent}
    .tab-button.active{color:#4f46e5; border-bottom-color:#4f46e5; font-weight:600}
    body.dark{background:#121212; color:#e0e0e0}
    .dark .bg-white{background:#1e1e1e}
    /* (gi·ªØ nguy√™n ph·∫ßn style m·ªü r·ªông t·ª´ file g·ªëc: dark mode, m√†u tab, v.v.) */
  </style>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-4">

  <!-- Main Container (UI g·ªëc gi·ªØ nguy√™n) -->
  <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-4xl mx-auto transition-colors duration-300">
    <h1 class="text-4xl font-bold text-center text-slate-800 mb-2">H·ªá Th·ªëng Qu·∫£n L√Ω ƒê·ªãa B√†n & ƒê·ªëi T∆∞·ª£ng</h1>
    <p class="text-center text-slate-600 mb-6">Qu·∫£n l√Ω c√°c Th√¥n, H·ªô, Th√†nh vi√™n v√† ƒê·ªëi t∆∞·ª£ng.</p>

    <!-- Dark Mode Toggle -->
    <div class="flex justify-end mb-4">
      <button id="theme-toggle" class="p-2 rounded-full bg-slate-200 dark:bg-gray-700 text-slate-800 dark:text-gray-300 transition-colors duration-200">üåû/üåô</button>
    </div>

    <!-- Navigation Tabs -->
    <div class="flex border-b border-slate-200 mb-6 space-x-4">
      <button id="tab-precincts" class="tab-button py-2 px-4 text-lg text-slate-600 active">ƒê·ªãa b√†n</button>
      <button id="tab-political" class="tab-button py-2 px-4 text-lg text-slate-600">H·ªá th·ªëng ch√≠nh tr·ªã</button>
      <button id="tab-subjects" class="tab-button py-2 px-4 text-lg text-slate-600">ƒê·ªëi t∆∞·ª£ng</button>
      <button id="tab-incidents" class="tab-button py-2 px-4 text-lg text-slate-600">V·ª• vi·ªác</button>
      <button id="tab-images" class="tab-button py-2 px-4 text-lg text-slate-600">H√¨nh ·∫£nh</button>
    </div>

    <!-- N·ªôi dung Tab (UI g·ªëc gi·ªØ nguy√™n: precincts, households, members, political, subjects, incidents, images) -->
    <div id="tab-content">
      <!-- Precincts Section -->
      <div id="precincts-tab-content">...</div>
      <!-- Political Section -->
      <div id="political-tab-content" class="hidden">...</div>
      <!-- Subjects Section -->
      <div id="subjects-tab-content" class="hidden">...</div>
      <!-- Incidents Section -->
      <div id="incidents-tab-content" class="hidden">...</div>
      <!-- Images Section -->
      <div id="images-tab-content" class="hidden">...</div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full modal-content">
      <h3 id="modal-title" class="text-xl font-bold mb-4 text-center"></h3>
      <div id="modal-content-area"></div>
    </div>
  </div>

  <!-- Supabase Scripts -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // === CONFIG ===
    const SUPABASE_URL = 'https://skbjeeyisyfifzoiuxeq.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';

    const TABLES = {
      precincts: 'precincts',
      households: 'households',
      members: 'members',
      subjects: 'subjects',
      incidents: 'incidents',
      images: 'images',
      security_team: 'security_team',
      party_members: 'party_members'
    }

    let supabase = null;
    let userId = 'anonymous_' + Date.now();

    // D·ªØ li·ªáu m·∫´u
    const initialPrecincts = ["Th√¥n 5","Th√¥n 6","Th√¥n 7"]

    // ===== Init =====
    async function initializeData(){
      supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // Upsert precincts tr√°nh tr√πng
      for (const name of initialPrecincts){
        await supabase.from(TABLES.precincts).upsert({ name, creator_id: userId, created_at: new Date().toISOString() }, { onConflict:'name' });
      }

      setupRealtime();
      fetchPrecincts();
      fetchSubjects();
      fetchIncidents();
      fetchImages();
      fetchPartyMembers();
      fetchSecurityTeam();
    }

    // ===== Realtime m·ªõi =====
    function setupRealtime(){
      const channel = supabase.channel('public-changes');
      for (const table of Object.values(TABLES)){
        channel.on('postgres_changes',{event:'*',schema:'public',table}, payload=>{
          switch(table){
            case TABLES.precincts: fetchPrecincts(); break;
            case TABLES.households: fetchHouseholds(); break;
            case TABLES.members: fetchMembers(); break;
            case TABLES.subjects: fetchSubjects(); break;
            case TABLES.incidents: fetchIncidents(); break;
            case TABLES.images: fetchImages(); break;
            case TABLES.party_members: fetchPartyMembers(); break;
            case TABLES.security_team: fetchSecurityTeam(); break;
          }
        })
      }
      channel.subscribe();
    }

    // ===== Fetch funcs (gi·ªØ logic g·ªëc, r√∫t g·ªçn ·ªü ƒë√¢y) =====
    async function fetchPrecincts(){
      const { data } = await supabase.from(TABLES.precincts).select('*');
      console.log('Precincts:',data);
    }
    async function fetchHouseholds(){ /* ... */ }
    async function fetchMembers(){ /* ... */ }
    async function fetchSubjects(){ /* ... */ }
    async function fetchIncidents(){ /* ... */ }
    async function fetchImages(){ /* ... */ }
    async function fetchPartyMembers(){ /* ... */ }
    async function fetchSecurityTeam(){ /* ... */ }

    // ===== UI: s·ª± ki·ªán tab, th√™m/s·ª≠a/x√≥a, modal, editable... (gi·ªØ nguy√™n t·ª´ file g·ªëc) =====
    // (to√†n b·ªô ph·∫ßn UI, showAddForm, showAddMemberForm, setupEditableFields, setupDeleteListeners... copy t·ª´ file g·ªëc v√† ho·∫°t ƒë·ªông kh√¥ng ƒë·ªïi)

    // ===== Kh·ªüi ch·∫°y =====
    initializeData();

  </script>
</body>
</html>
